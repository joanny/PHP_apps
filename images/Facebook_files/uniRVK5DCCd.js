/*1322474713,176832695*/

if (window.CavalryLogger) { CavalryLogger.start_js(["rPp7Y"]); }

var MusicDiagnosticLogger=(function(){var b='attempt';var e='success';var c='invalidate';var d='pending';var a={INSTALL:'install',INSTALL_CANCEL:'install_canceled',LAUNCH:'launch',LAUNCH_CANCEL:'launch_canceled',PLAY:'play',PLAY_ALREADY:'play_already_open',PLAY_INSTALL:'play_install',TOS_SHOWN:'tos_shown',TOS_CANCEL:'tos_canceled',SWITCH_AWAY:'switched_away_from'};var f={};var i={};var j={};var k={};var l={};var g={};var h=false;function n(r,o,p){var q=p.provider;if(!g[q])return;if(r==='user_action'){switch(p.action){case MusicDiagnostics.TOS_SHOWN:m(q,a.TOS_SHOWN);break;case MusicDiagnostics.PLAY_SONG:l[q]=d;if(i[q]===d){m(q,a.PLAY_INSTALL,b);}else if(f[q]===d)m(q,a.PLAY_ALREADY,b);m(q,a.PLAY,b);break;case MusicDiagnostics.TOS_CLICK_CANCEL:case MusicDiagnostics.INSTALL_CLICK_CANCEL:case MusicDiagnostics.LAUNCH_CLICK_CANCEL:case MusicDiagnostics.SWITCHED_PROVIDER:if(l[q]===d){l[q]=true;m(q,a.PLAY,c);}if(j[q]===d){j[q]=true;m(q,a.INSTALL,c);}if(p.action===MusicDiagnostics.INSTALL_CLICK_CANCEL){m(q,a.INSTALL_CANCEL);}else if(p.action===MusicDiagnostics.SWITCHED_PROVIDER){m(q,a.SWITCH_AWAY);}else if(p.action===MusicDiagnostics.LAUNCH_CLICK_CANCEL){m(q,a.LAUNCH_CANCEL);}else if(p.action===MusicDiagnostics.TOS_CLICK_CANCEL)m(q,a.TOS_CANCEL);case MusicDiagnostics.LAUNCH_NOT_NEEDED:if(k[q]===d){k[q]=true;m(q,a.LAUNCH,c);}if(p.action===MusicDiagnostics.LAUNCH_NOT_NEEDED)f[q]=d;break;case MusicDiagnostics.INSTALL_STARTED:i[q]=d;j[q]=d;m(q,a.INSTALL,b);break;case MusicDiagnostics.ATTEMPTING_LAUNCH:k[q]=d;m(q,a.LAUNCH,b);break;}}else if(r==='receive'){if(p.data&&p.data.playing){if(l[q]&&l[q]===d){if(i[q]===d){i[q]=false;m(q,a.PLAY_INSTALL,e);}else if(f[q]===d)m(q,a.PLAY_ALREADY,e);m(q,a.PLAY,e);l[q]=true;}if(j[q]&&j[q]===d){m(q,a.INSTALL,e);j[q]=true;}}if(p.op===MusicConstants.STATUS_CHANGE_OP.STATUS){if(j[q]&&j[q]===d){m(q,a.INSTALL,e);j[q]=true;}if(k[q]&&k[q]===d){m(q,a.LAUNCH,e);k[q]=true;}}}else if(r==='state_change')if(p.to===MusicConstants.DIAGNOSTIC_EVENT.OFFLINE)f[q]=false;}function m(p,q,o){if(o)q+='.'+o;MusicLogger.log(MusicLogger.PLATFORM,{type:q,time:new Date(),provider:p});}return {init:function(o){g[o]=true;if(h)return;Arbiter.subscribe('MusicDiagnostics/state_change',n.curry('state_change'));Arbiter.subscribe('MusicDiagnostics/receive',n.curry('receive'));Arbiter.subscribe('MusicDiagnostics/user_action',n.curry('user_action'));h=true;}};})();