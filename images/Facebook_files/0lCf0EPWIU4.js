/*1326834512,176820407*/

if (window.CavalryLogger) { CavalryLogger.start_js(["oW\/FK"]); }

__d("Live",["array-extensions","json","Arbiter","AsyncDOM","ArrayUtils","AsyncSignal","DataStore","dom","presence-arbiter-message","Util","invokeCallbacks"],function(k,n,o,m,j){n("array-extensions");n("json");var a=n("Arbiter");var c=n("AsyncDOM");var b=n("ArrayUtils");var d=n("AsyncSignal");var f=n("DataStore");var e=n("dom");var h=n("presence-arbiter-message");var i=n("Util");var l=n("invokeCallbacks");var g={logAll:false,startup:function(){g.startup=bagofholding;a.subscribe(h.getArbiterMessageType('live'),g.handleMessage.bind(g));},lookupLiveNode:function(q,p){var r=e.scry(document.body,'.live_'+q+'_'+p);r.forEach(function(t){if(f.get(t,'seqnum')===undefined){var s=JSON.parse(t.getAttribute('data-live'));f.set(t,'seqnum',s.seq);}});return r;},handleMessage:function(u,q){var s=q.obj;var r=s.fbid;var p=s.assoc;var t=this.lookupLiveNode(r,p);if(!t)return false;t.forEach(function(z){if(s.expseq){var x=f.get(z,'seqnum');var v=f.get(z,'message_buffer');if(v===undefined){v={};f.set(z,'message_buffer',v);}var w={obj:s};v[s.expseq]=w;if(s.expseq!=x){g.log('mismatch',s.fbid,s.expseq,x);return false;}while(true){x=f.get(z,'seqnum');var y=v[x];if(y){g._applyUpdates(y.obj.updates,z);g.log('seqmatch',s.fbid,'exp',s.expseq,'cur',x);delete v[x];}else break;}}else g._applyUpdates(s.updates,z);});},_applyUpdates:function(r,q){try{if(typeof r[0]=='string'){q={getRelativeTo:bagof(q)};l(b.createFrom(r),q);}else c.invoke(r,q);}catch(p){}},log:function(){if(g.logAll){var p=b.createFrom(arguments).join(":");new d('/common/scribe_endpoint.php',{c:'live_sequence',m:p}).send();}}};m.exports=g;});
__d("legacy:live-js",["Live"],function(a,b,c){a.Live=b('Live');},3);